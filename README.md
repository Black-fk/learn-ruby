# **Scanner B√°sico de Seguran√ßa em Ruby - Documenta√ß√£o Completa**

Este documento explica detalhadamente um scanner de seguran√ßa b√°sico escrito em Ruby, que realiza verifica√ß√µes de portas abertas, diret√≥rios web e testes b√°sicos de vulnerabilidades (SQLi e XSS).

---

## **1. Estrutura Geral do C√≥digo**
O scanner est√° organizado em uma √∫nica classe `BasicScanner` com os seguintes componentes principais:

| M√©todo/Funcionalidade | Descri√ß√£o |
|-----------------------|-----------|
| `initialize` | Configura op√ß√µes padr√£o e analisa argumentos da CLI |
| `parse_options` | Processa argumentos de linha de comando (`-h`, `-p`, etc.) |
| `validate_options` | Valida se o host alvo foi fornecido |
| `run` | M√©todo principal que executa todas as verifica√ß√µes |
| `scan_ports` | Verifica portas abertas no host alvo |
| `scan_directories` | Testa diret√≥rios comuns em servidores web |
| `test_basic_vulnerabilities` | Inicia testes de SQLi e XSS |
| `test_sql_injection` | Realiza testes b√°sicos de SQL injection |
| `test_xss` | Realiza testes b√°sicos de XSS |

---

## **2. Depend√™ncias e Bibliotecas Utilizadas**
```ruby
require 'socket'       # Para verifica√ß√£o de portas (TCP)
require 'net/http'     # Para requisi√ß√µes HTTP (diret√≥rios, SQLi, XSS)
require 'optparse'     # Para an√°lise de argumentos da CLI
require 'timeout'      # Para definir timeout em conex√µes
```
- **`socket`**: Usado para verificar portas TCP abertas.
- **`net/http`**: Realiza requisi√ß√µes HTTP para testar diret√≥rios e vulnerabilidades.
- **`optparse`**: Facilita a cria√ß√£o de um parser de argumentos de linha de comando.
- **`timeout`**: Define um tempo m√°ximo para tentativas de conex√£o.

---

## **3. Configura√ß√£o Inicial e Argumentos da CLI**
### **Op√ß√µes Padr√£o**
```ruby
@options = {
  host: nil,                      # Host alvo (obrigat√≥rio)
  ports: [80, 443, 8080, 22, 21], # Portas padr√£o para scan
  wordlist: ['admin', 'login', 'wp-admin', 'backup', 'config'], # Diret√≥rios comuns
  timeout: 5                      # Tempo limite para conex√µes (segundos)
}
```

### **Parser de Argumentos (`parse_options`)**
| Argumento | Descri√ß√£o | Exemplo |
|-----------|-----------|---------|
| `-h`, `--host` | Define o host alvo | `./scanner.rb -h exemplo.com` |
| `-p`, `--ports` | Lista de portas para scanear | `-p 80,443,8080` |
| `-w`, `--wordlist` | Lista de diret√≥rios para testar | `-w admin,login,test` |
| `-t`, `--timeout` | Tempo limite para conex√µes | `-t 3` |

---

## **4. Funcionalidades do Scanner**
### **A. Scanner de Portas (`scan_ports`)**
Verifica se as portas especificadas est√£o abertas no host alvo.

**M√©todo:**
```ruby
def scan_ports
  @options[:ports].each do |port|
    begin
      Timeout.timeout(@options[:timeout]) do
        socket = TCPSocket.new(@options[:host], port)
        puts "[+] Porta #{port}/tcp aberta"
        socket.close
      end
    rescue Timeout::Error
      puts "[-] Timeout na porta #{port}"
    rescue Errno::ECONNREFUSED
      # Porta fechada (n√£o imprime nada)
    rescue => e
      puts "[-] Erro ao verificar porta #{port}: #{e.message}"
    end
  end
end
```

**Comportamento:**
- Tenta estabelecer uma conex√£o TCP em cada porta.
- Se a conex√£o for bem-sucedida, a porta est√° aberta.
- Se falhar com `ECONNREFUSED`, a porta est√° fechada.
- Se ocorrer timeout, considera a porta como filtrada/inacess√≠vel.

---

### **B. Scanner de Diret√≥rios (`scan_directories`)**
Testa a exist√™ncia de diret√≥rios comuns em servidores web.

**M√©todo:**
```ruby
def scan_directories
  http = Net::HTTP.new(@options[:host], 80)
  http.open_timeout = @options[:timeout]
  http.read_timeout = @options[:timeout]

  @options[:wordlist].each do |dir|
    begin
      response = http.request(Net::HTTP::Get.new("/#{dir}"))
      
      case response.code.to_i
      when 200..299
        puts "[+] Diret√≥rio encontrado: /#{dir} (HTTP #{response.code})"
      when 401, 403
        puts "[!] Diret√≥rio protegido: /#{dir} (HTTP #{response.code})"
      end
    rescue => e
      puts "[-] Erro ao verificar /#{dir}: #{e.message}"
    end
  end
end
```

**Comportamento:**
- Envia uma requisi√ß√£o `GET` para cada diret√≥rio na wordlist.
- Se retornar `200-299`, o diret√≥rio existe.
- Se retornar `401` ou `403`, o diret√≥rio existe mas est√° protegido.
- Se falhar, registra o erro.

---

### **C. Teste de SQL Injection (`test_sql_injection`)**
Verifica vulnerabilidades b√°sicas de SQLi em formul√°rios de login.

**Payloads testados:**
```ruby
payloads = [
  "' OR '1'='1",   # SQLi cl√°ssico
  "admin'--",       # Comentando o resto da query
  "1' OR 1=1#"      # Outra varia√ß√£o comum
]
```

**M√©todo:**
```ruby
def test_sql_injection
  uri = URI("http://#{@options[:host]}/login.php")
  http = Net::HTTP.new(uri.host, uri.port)
  http.open_timeout = @options[:timeout]
  http.read_timeout = @options[:timeout]

  payloads.each do |payload|
    params = { 'username' => payload, 'password' => 'test' }
    response = http.post(uri.path, URI.encode_www_form(params))

    if response.body.downcase.include?('bem-vindo') || 
       response.body.downcase.include?('welcome') || 
       response['location']&.include?('dashboard')
      puts "[!] Poss√≠vel SQLi com payload: #{payload}"
    end
  end
end
```

**L√≥gica de Detec√ß√£o:**
- Se a resposta cont√©m "bem-vindo", "welcome" ou redireciona para um dashboard, h√° ind√≠cio de SQLi.

---

### **D. Teste de XSS (`test_xss`)**
Verifica se entradas s√£o refletidas sem sanitiza√ß√£o.

**Payloads testados:**
```ruby
payloads = [
  "<script>alert('XSS')</script>",  # XSS b√°sico
  "<img src=x onerror=alert(1)>",    # XSS via atributo HTML
  "\"><svg/onload=alert(1)>"         # XSS via tag SVG
]
```

**M√©todo:**
```ruby
def test_xss
  uri = URI("http://#{@options[:host]}/search.php")
  http = Net::HTTP.new(uri.host, uri.port)
  http.open_timeout = @options[:timeout]
  http.read_timeout = @options[:timeout]

  payloads.each do |payload|
    response = http.get("#{uri.path}?q=#{URI.encode_www_form_component(payload)}")

    if response.body.include?(payload)
      puts "[!] Poss√≠vel XSS com payload: #{payload}"
    end
  end
end
```

**L√≥gica de Detec√ß√£o:**
- Se o payload aparece na resposta sem sanitiza√ß√£o, h√° risco de XSS.

---

## **5. Como Executar o Scanner**
### **Comandos B√°sicos**
```bash
# Scan b√°sico em um host
./scanner.rb -h exemplo.com

# Scan com portas personalizadas
./scanner.rb -h exemplo.com -p 80,443,8080

# Scan com wordlist personalizada
./scanner.rb -h exemplo.com -w admin,test,backup

# Definir timeout menor (3 segundos)
./scanner.rb -h exemplo.com -t 3
```

### **Sa√≠da Esperada**
```
[+] Iniciando scan no alvo: exemplo.com
[+] Hora de in√≠cio: 2023-05-23 20:30:00

[+] Verificando portas abertas...
[+] Porta 80/tcp aberta
[+] Porta 443/tcp aberta

[+] Procurando diret√≥rios comuns...
[+] Diret√≥rio encontrado: /admin (HTTP 200)
[!] Diret√≥rio protegido: /config (HTTP 403)

[+] Testando vulnerabilidades b√°sicas...
[!] Poss√≠vel SQLi com payload: ' OR '1'='1
[!] Poss√≠vel XSS com payload: <script>alert('XSS')</script>

[+] Scan conclu√≠do em: 2023-05-23 20:32:15
```

---

## **6. Melhorias Futuras**
1. **Adicionar suporte a HTTPS** (usando `Net::HTTP` com SSL).
2. **Implementar multi-threading** para scans mais r√°pidos.
3. **Adicionar mais testes** (ex.: CSRF, File Inclusion).
4. **Gerar relat√≥rios em HTML/JSON** para an√°lise posterior.
5. **Integrar com ferramentas como Burp Suite** via API.

---

## **7. Considera√ß√µes de Seguran√ßa**
- ‚ö†Ô∏è **Use apenas em sistemas autorizados**.
- üîí **N√£o use para atividades maliciosas**.
- üìú **Este scanner √© para fins educacionais**.

---

**Reposit√≥rio GitHub:** [https://github.com/seuuser/ruby-scanner](https://github.com/seuuser/ruby-scanner)  
**Licen√ßa:** MIT  

**D√∫vidas?** Contribui√ß√µes s√£o bem-vindas! üöÄ
